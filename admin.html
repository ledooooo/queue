<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
  <style>body{font-family:'Tajawal',sans-serif;background:#d0e6f2}</style>
</head>
<body class="min-h-screen p-6">
  <h1 class="text-3xl font-bold text-center text-[#004156] mb-6">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª</h1>

  <div class="max-w-3xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Ø¥Ø¶Ø§ÙØ© -->
    <div class="bg-white p-6 rounded-2xl shadow-xl space-y-4">
      <h2 class="text-xl font-bold text-[#004156]">Ø¥Ø¶Ø§ÙØ© Ø¹ÙŠØ§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
      <input id="newInp" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹ÙŠØ§Ø¯Ø©" class="w-full p-3 border rounded-lg">
      <button id="addBtn" class="w-full py-3 bg-blue-700 text-white rounded-lg hover:bg-blue-800">Ø£Ø¶Ù</button>
    </div>

    <!-- Ø¥Ø¯Ø§Ø±Ø© -->
    <div class="bg-white p-6 rounded-2xl shadow-xl space-y-4">
      <h2 class="text-xl font-bold text-[#004156]">Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
      <ul id="list" class="space-y-3"></ul>
    </div>
  </div>
  <!-- Ù„ÙˆØ­Ø© Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…Ø±ÙŠØ¶ -->
<div class="bg-white p-4 rounded-xl shadow mt-4 max-w-2xl mx-auto space-y-3">
  <h3 class="font-bold text-[#004156]">Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…Ø±ÙŠØ¶</h3>

  <!-- Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ -->
  <input id="ptName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶" dir="rtl"
         class="w-full p-3 border rounded-lg text-lg">

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
  <div class="flex gap-2">
    <button id="speakBtn" class="flex-1 py-2 bg-blue-700 text-white rounded hover:bg-blue-800">
      Ù†Ø·Ù‚ ÙˆØ¹Ø±Ø¶
    </button>
    <button id="micBtn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
      ğŸ¤
    </button>
  </div>

  <!-- Ø±Ø³Ø§Ù„Ø© ØµØºÙŠØ±Ø© -->
  <p id="recMsg" class="text-xs text-gray-500 hidden">Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† ÙˆØªØ­Ø¯Ø« Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</p>
</div>

<!-- Ø¹Ù†ØµØ± ØªØ­ÙƒÙ… Ø§Ù„Ø³Ø±Ø¹Ø© -->
<script type="module">
  import { buildSpeedControl } from './js/tts.js';
  buildSpeedControl(); // ÙŠÙÙ†Ø´Ø¦ Ø§Ù„Ø¹Ù†ØµØ± ÙˆÙŠÙÙ„ØµÙ‚Ù‡ Ø¨Ø§Ù„ØµÙØ­Ø©
</script>
  
  <script type="module">
    import { api } from "./js/api.js";
    async function render() {
      const list = document.getElementById('list'); list.innerHTML = '';
      const clinics = await api.getClinics();
      if (!clinics.length) { list.innerHTML = '<li class="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹ÙŠØ§Ø¯Ø§Øª</li>'; return; }
      clinics.forEach(({id, name}) => list.insertAdjacentHTML('beforeend', `
        <li class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
          <span class="font-bold text-lg text-[#2a3e48]">${name}</span>
          <div class="flex gap-2">
            <input type="text" class="renameInp px-3 py-1 border rounded" placeholder="Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯" data-id="${id}">
            <button class="renameBtn px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-800" data-id="${id}">ØªØ³Ù…ÙŠØ©</button>
            <button class="delBtn px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700" data-id="${id}">Ø­Ø°Ù</button>
          </div>
        </li>`));
    }
    render();

    document.getElementById('addBtn').addEventListener('click', async () => {
      const v = document.getElementById('newInp').value.trim();
      if (v) { await api.addClinic(v); document.getElementById('newInp').value = ''; render(); }
    });

    document.getElementById('list').addEventListener('click', async e => {
      const id = e.target.dataset.id;
      if (!id) return;
      if (e.target.classList.contains('delBtn')) { if (confirm('Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) { await api.deleteClinic(id); render(); } }
      if (e.target.classList.contains('renameBtn')) {
        const inp = e.target.parentElement.querySelector(`.renameInp[data-id="${id}"]`), v = inp.value.trim();
        if (v) { await api.renameClinic(id, v); inp.value = ''; render(); }
      }
    });
  </script>

<script type="module">
  import { ref, set, push } from "./js/firebase-config.js";

  const ptName   = document.getElementById('ptName');
  const speakBtn = document.getElementById('speakBtn');
  const micBtn   = document.getElementById('micBtn');
  const recMsg   = document.getElementById('recMsg');

  /* ===== Ù†Ø·Ù‚ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ display ===== */
  speakBtn.onclick = () => {
    const name = ptName.value.trim();
    if (!name) return alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶');
    // Ù†ÙƒØªØ¨ ÙÙ‰ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­Øª ÙØ±Ø¹ patientCall
    const callRef = push(ref(db, 'patientCall'));
    set(callRef, { name: name, ts: Date.now() });
    ptName.value = '';
  };

  /* ===== Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† (Arabic) ===== */
  if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
    const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
    const rec = new Speech();
    rec.lang = 'ar-SA';
    rec.interimResults = false;
    rec.continuous = false;

    rec.onresult = e => {
      ptName.value = e.results[0][0].transcript;
    };
    rec.onerror = () => ptName.value = '';

    micBtn.onmousedown = () => { rec.start(); recMsg.classList.remove('hidden'); };
    micBtn.onmouseup   = () => { rec.stop();  recMsg.classList.add('hidden'); };
    micBtn.onmouseleave = () => { rec.stop(); recMsg.classList.add('hidden'); };
  } else {
    micBtn.disabled = true;
    micBtn.title = 'Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ';
  }
</script>

  
</body>

</html>



