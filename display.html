<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
ย <meta charset="UTF-8">
ย <title>ุดุงุดุฉ ุทุงุจูุฑ ุงูุนูุงุฏุงุช</title>
ย <script src="https://cdn.tailwindcss.com"></script>
ย <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
ย <style>
ย ย body { font-family: 'Tajawal', sans-serif; background: #d0e6f2; }
ย ย /* ุนุฏูู ุงูุงุฑุชูุงุน ุญุณุจ ุดุงุดุชู */
ย ย #topPanelย ย { height: 30vh; }
ย ย #videoPanelย { height: 70vh; }
ย ย .cardย ย ย ย { background: #ffffff; border-radius: 1rem; box-shadow: 0 8px 20px rgba(0,0,0,.08); }
ย ย .numย ย ย ย ย{ font-size: 4rem; line-height: 1; color: #004156; }
ย ย @media (min-width:768px){ .num { font-size: 5rem; } }

    /* ๐ก ุงูููุทุฉ ุงูุฃุณุงุณูุฉ: ูุฐุง ุงูููุฏ ููุฑุถ ุนุฑุถ ุงูุจุทุงูุงุช ุฌูุจูุง ุฅูู ุฌูุจ ููุฑููุชูุง */
ย ย #cards {
ย ย ย /* ูุญุฏุฏ ุงูุญุฏ ุงูุฃุฏูู ูุนุฑุถ ุงูุจุทุงูุฉ ุจู 200pxุ ุซู ููุณู ุงููุณุงุญุฉ ุงูุจุงููุฉ ุจุงูุชุณุงูู */
ย ย ย grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
ย ย }
ย </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

ย ย <section id="topPanel" class="w-full p-4 overflow-y-auto">
ย ย <h1 class="text-3xl md:text-4xl font-extrabold text-center text-[#004156] mb-4">ุงูุฑูู ุงูุญุงูู</h1>
ย ย ย ย <div id="cards" class="grid gap-4"></div> 
ย </section>

ย ย <section id="videoPanel" class="w-full bg-black flex items-center justify-center">
ย ย ย ย <iframe 
ย ย ย width="100%" 
ย ย ย height="100%" 
ย ย ย src="https://www.youtube.com/embed/9z3sJxG-6SU?si=VIeP_WApWUqQ0dAc&autoplay=1&mute=1&loop=1&playlist=9z3sJxG-6SU" 
ย ย ย title="YouTube video player" 
ย ย ย frameborder="0" 
ย ย ย allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
ย ย ย referrerpolicy="strict-origin-when-cross-origin" 
ย ย ย allowfullscreen
ย ย ย class="h-full w-full object-cover" 
ย ย ></iframe>
ย </section>

<script type="module">
ย ย import { db, ref, onValue } from "./js/firebase-config.js";

ย ย const container = document.getElementById('cards');
ย ย const currentClinicNumbers = {}; 
ย ย const synth = window.speechSynthesis; 

ย ย // ุฏุงูุฉ ุงููุทู
ย ย function speakArabic(text) {
ย ย ย if (!synth) {
ย ย ย ย console.warn('Speech Synthesis API is not supported in this browser.');
ย ย ย ย return;
ย ย ย }

ย ย ย const utterance = new SpeechSynthesisUtterance(text);
ย ย ย utterance.lang = 'ar-SA'; 
ย ย ย utterance.rate = 0.9; 

ย ย ย synth.cancel();
ย ย ย synth.speak(utterance);
ย ย }

ย ย onValue(ref(db, 'clinics'), snap => {
ย ย ย container.innerHTML = '';
ย ย ย const data = snap.val() || {};
ย ย ย 
ย ย ย let didUpdateOccur = false; 
ย ย ย let newCallText = ''; 

ย ย ย Object.keys(data).forEach(id => {
ย ย ย ย const {name, currentNumber} = data[id];
ย ย ย ย 
ย ย ย ย // ุงูุชุญูู ูู ุงูุชุบููุฑ ูุงููุทู
ย ย ย ย if (currentClinicNumbers[id] !== currentNumber) {
ย ย ย ย ย didUpdateOccur = true;
ย ย ย ย ย 
ย ย ย ย ย newCallText += `ูุฑุฌู ูู ุตุงุญุจ ุงูุฑูู ${currentNumber} ุงูุชูุฌู ุฅูู ุนูุงุฏุฉ ${name}. `;

ย ย ย ย ย currentClinicNumbers[id] = currentNumber;
ย ย ย ย }

ย ย ย ย // ุจูุงุก ุจุทุงูุงุช ุงูุนูุงุฏุงุช
ย ย ย ย container.insertAdjacentHTML('beforeend', `
ย ย ย ย ย <div class="card p-4 flex flex-col items-center justify-center">
ย ย ย ย ย ย <h2 class="text-lg md:text-xl font-bold text-[#2a3e48] mb-2">${name}</h2>
ย ย ย ย ย ย <p class="num font-extrabold">${currentNumber}</p>
ย ย ย ย ย ย <span class="text-sm text-gray-500 mt-1">ุงูุฑูู ุงูุญุงูู</span>
ย ย ย ย ย </div>`);
ย ย ย });
ย ย ย 
ย ย ย // ุชูููุฐ ุงููุทู ุนูุฏ ูุฌูุฏ ุชุญุฏูุซุงุช
ย ย ย if (didUpdateOccur && newCallText) {
ย ย ย ย speakArabic(newCallText);
ย ย ย }
ย ย });
ย </script>
</body>
</html>
